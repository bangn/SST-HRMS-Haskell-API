sudo: true

language: haskell

git:
  depth: 5

cache:
  directories:
  - "$HOME/.cabal"
  - "$HOME/.stack"
  - "$TRAVIS_BUILD_DIR/.stack-work"

matrix:
  include:
  - ghc: 8.6.3
    env: GHCVER='8.6.3' CABALVER='head'
    os: linux
    addons:
      apt:
        sources:
        - hvr-ghc
        packages:
        - ghc-8.6.3
        - cabal-install-head
  - ghc: 8.6.3
    env: GHCVER='8.6.3' STACK_YAML="$TRAVIS_BUILD_DIR/stack.yaml"
    os: linux
    addons:
      apt:
        packages:
        - libgmp-dev

install:
- |
  if [ -z "$STACK_YAML" ]; then
    export PATH="/opt/ghc/$GHCVER/bin:/opt/cabal/$CABALVER/bin:$PATH"
    echo "$PATH"
    cabal new-update
    cabal new-build --enable-tests --enable-benchmarks
  else
    mkdir -p ~/.local/bin
    export PATH="$HOME/.local/bin:$PATH"
    travis_retry curl -L 'https://www.stackage.org/stack/linux-x86_64' | tar xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'
    stack --version
    stack setup --no-terminal --install-cabal 2.2.0.1
    stack ghc -- --version
    stack build --only-dependencies --no-terminal
  fi

script:
- |
  if [ -z "$STACK_YAML" ]; then
    cabal new-test
  else
    stack build --test --bench --no-run-benchmarks --no-terminal --ghc-options=-Werror
  fi
- curl -sSL https://raw.github.com/ndmitchell/neil/master/misc/travis.sh | sh -s --
  hlint .

notifications:
  email: false

deploy:
  provider: heroku
  api_key:
    secure: YNpHLcxQ7q2miiFc1+uHxQmHWCyZi8RKMWT/PmMJ0jGKjcaT1/2+S8Mwu8A4jfGaoQp3qyZ9gnma0X1v11dWGvTeYdN2/tqLbFu7836ZkU+r1WVRMS6AsYwk1y/UNyeyVErHRP2LMX1FlonbcHRUAfNzEPsAaBs1cHCcBu+QgieY7+d8/fQMB13SQpPNpX7XMpqOGNmKYxQQSSlp/15vnial24g7gghPLmsFa1ENI74FFlk/IMRPwUDFsi//9tNHUwcTWhwfqhq4t9H/L+SMIfKgJieiSOgq7RNJHes2DomLKRaWVetjtEObFRvtJXB4inGDzjW7dyLWLPV17Zt5hel1Vt5BlwX2gkliMzEH6hcbn9BwjIAiSVriAtZq0R53qlB8OXvryy24fkhTYhV2BRmgM1fPbuAFwX+QmrPn5zBfRi1I4811Kf61/bP+r46qkgk57tE7zjqrrMqyrZ5dl4ebZBD5R3ABVnFmSJRMM5QK6LHJzHAVPcEBSzr9wi/uYUrCENqXN3PB9sERRWY2jSI06kG/HOhHLLRTGiyemNbAXdqRkrcHbFvUBVYSG9O0MCIDwgo5le04rMCjSidchAYyuDB8TCbZrdj7p+IcmsAMnPbJegSAdoWCQHqyYATJ/v4CH6TY3ShB4+7bzSYoBQRK12ZJnXmVze3XJEGK7b8=
  app: sst-hrms-api
  on:
    repo: bangn/sst-hrms-haskell-api
